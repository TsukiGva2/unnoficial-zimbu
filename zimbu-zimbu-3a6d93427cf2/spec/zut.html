<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<title>Zimbu Templates Specification</title>
<meta name="Generator" content="Vim/7.4">
<style type="text/css">
<!--
body {
  font-family: arial,sans-serif;
  color: #000000;
  background-color: #ffffff;
}
pre {
  white-space: pre-wrap;
  font-family: monospace;
  color: #000000;
  font-size: 1.1em;
  padding: 4px;
}
.sep1 {
  width: 100%;
  height: 12px;
  background-color: #88aa66;
  margin-top: 60px;
}
.sep2 {
  width: 100%;
  height: 6px;
  background-color: #88aa66;
  margin-top: 30px;
}
table {
  border-collapse: collapse;
}
ul, ol {
  margin-top: -1em;
}
a:link {
  color: #0000ff;
  text-decoration: none;
}
a:visited {
  color: #0000ff;
}
a:hover {
  color: #800080;
  text-decoration: underline;
}
.topItem, .topItem a:link, .topItem a:visited {
  color: #000000;
  font-size: 24px;
}
.topItem a:hover {
  color: #800080;
}
.contItem {
  color: #0000ff;
  margin-left: 20px;
}
.contLead {
  line-height: 12px;
  margin-bottom: 5px;
  margin-left: 60px;
}
.contSub {
  color: #000000;
  font-size: 12px;
  margin-right: 12px;
}
.contSub a:link, .contSub a:visited {
  color: #000000;
  font-size: 12px;
}
.contSub a:hover {
  color: #800080;
}
.vimCodeElement {
  background-color: #eeffcc;
  border-color: #88aa66;
  border-style: solid none;
  border-width: 1px medium;
}
.command {
  background-color: #eeeeff;
  border-color: #8888aa;
  border-style: solid none;
  border-width: 1px medium;
}
h3 {
  display: inline-block;
  margin-bottom: 0;
}
h4 {
  display: inline-block;
  margin-bottom: 0;
}
h5 {
  display: inline-block;
  margin-bottom: 0;
}
.rationale {
  background-color: #ddddff;
  border-color: #6666dd;
  border-style: solid none;
  border-width: 1px medium;
  padding: 0 8px;
}
.openclose {
  display: inline-block;
  font-size: 12px;
  margin-left: 20px;
}
.firstrow {
  font-weight: bold;
}
.firstcol {
}
.col {
  padding-left: 10px;
}
.Type { color: #008000; }
.Ignore { color: #ffffff; }
.Statement { color: #8b0000; }
.Comment { color: #0000c0; }
.Constant { color: #c00000; }
.PreProc { color: #c000c0; }
.Todo { color: #000000; background-color: #ffff00; padding-bottom: 1px; }
-->
</style>
<script>
function showHide(name) {
  var el = document.getElementById(name);
  if (el.style.display == "none") {
    el.style.display = "block";
  } else {
    el.style.display = "none";
  }
}
</script>
</head>
<body>
<h1>Zimbu Templates Specification</h1>

<p>Last Change: 2015 Sep 29
</p>

<img src="underconstruction.png">&nbsp;UNDER CONSTRUCTION

<p>This page contains both an informal explanation and a formal specification of
Zimbu Templates or ZUT.<br>
</p>

<p>Zimbu Templates contain HTML and CSS mixed with Zimbu commands and expressions.
They result in HTML pages that can be interactively used in a browser.
</p>

<p>Zimbu Templates can be used both on the server and in the browser.  On the
server they are compiled into efficient binary code.  For the browser they are
compiled into Javascript.
</p>


<div class="sep2"></div>
<h2>Contents</h2>
<div class="topItem"><a href="#ZUT%32File">ZUT File</a></div>
<div class="contItem"><a href="#Preprocessing">Preprocessing</a></div>
<div class="contItem"><a href="#File%32Level">File Level</a></div>
<div class="contItem"><a href="#Comments">Comments</a></div>
<div class="contItem"><a href="#Special%32characters">Special characters</a></div>
<div class="contItem"><a href="#White%32space%32removal">White space removal</a></div>
<div class="topItem"><a href="#CSS%32template%32%45%32ZUT%46Css">CSS template - ZUT.Css</a></div>
<div class="contItem"><a href="#nameless%32CSS%32block">nameless CSS block</a></div>
<div class="contLead">
<span class="contSub"><a href="#nameless%32CSS%32block_Example">Example</a></span>
</div>
<div class="contItem"><a href="#CSS%32template">CSS template</a></div>
<div class="contLead">
<span class="contSub"><a href="#CSS%32template_Example">Example</a></span>
</div>
<div class="topItem"><a href="#HTML%32template%32%45%32ZUT%46Html">HTML template - ZUT.Html</a></div>
<div class="contLead">
<span class="contSub"><a href="#HTML%32template%32%45%32ZUT%46Html_Example">Example</a></span>
</div>
<div class="topItem"><a href="#Attributes%32template%32%45%32ZUT%46Attributes">Attributes template - ZUT.Attributes</a></div>
<div class="contLead">
<span class="contSub"><a href="#Attributes%32template%32%45%32ZUT%46Attributes_Example">Example</a></span>
</div>
<div class="topItem"><a href="#URL%32template%32%45%32ZUT%46Url">URL template - ZUT.Url</a></div>
<div class="contLead">
<span class="contSub"><a href="#URL%32template%32%45%32ZUT%46Url_Example">Example</a></span>
</div>
<div class="topItem"><a href="#Text%32template">Text template</a></div>
<div class="contLead">
<span class="contSub"><a href="#Text%32template_Example">Example</a></span>
<span class="contSub"><a href="#Text%32template_No%32escaping">No escaping</a></span>
</div>
<div class="topItem"><a href="#Javascript%32template%32%45%32ZUT%46Javascript">Javascript template - ZUT.Javascript</a></div>
<div class="contLead">
<span class="contSub"><a href="#Javascript%32template%32%45%32ZUT%46Javascript_Example">Example</a></span>
</div>
<div class="topItem"><a href="#ZUT%46Context">ZUT.Context</a></div>
<div class="topItem"><a href="#Template%32items">Template items</a></div>
<div class="contItem"><a href="#Zimbu%32statement">Zimbu statement</a></div>
<div class="contItem"><a href="#Zimbu%32expression">Zimbu expression</a></div>
<div class="contItem"><a href="#Escaping%32and%32filtering%32contexts">Escaping and filtering contexts</a></div>
<div class="contLead">
<span class="contSub"><a href="#Escaping%32and%32filtering%32contexts_HTML">HTML</a></span>
<span class="contSub"><a href="#Escaping%32and%32filtering%32contexts_HTML%32data">HTML data</a></span>
<span class="contSub"><a href="#Escaping%32and%32filtering%32contexts_HTML%32tag%32name">HTML tag name</a></span>
<span class="contSub"><a href="#Escaping%32and%32filtering%32contexts_HTML%32attributes">HTML attributes</a></span>
<span class="contSub"><a href="#Escaping%32and%32filtering%32contexts_HTML%32attribute%32value">HTML attribute value</a></span>
<span class="contSub"><a href="#Escaping%32and%32filtering%32contexts_HTML%32style%32attribute%32value">HTML style attribute value</a></span>
<span class="contSub"><a href="#Escaping%32and%32filtering%32contexts_ZUT%46Css">ZUT.Css</a></span>
<span class="contSub"><a href="#Escaping%32and%32filtering%32contexts_HTML%32script%32attribute%32value">HTML script attribute value</a></span>
<span class="contSub"><a href="#Escaping%32and%32filtering%32contexts_ZUT%46Javascript">ZUT.Javascript</a></span>
<span class="contSub"><a href="#Escaping%32and%32filtering%32contexts_HTML%32unquoted%32attribute%32value">HTML unquoted attribute value</a></span>
<span class="contSub"><a href="#Escaping%32and%32filtering%32contexts_URL">URL</a></span>
<span class="contSub"><a href="#Escaping%32and%32filtering%32contexts_CSS">CSS</a></span>
<span class="contSub"><a href="#Escaping%32and%32filtering%32contexts_CSS%32string">CSS string</a></span>
<span class="contSub"><a href="#Escaping%32and%32filtering%32contexts_CSS%32URL">CSS URL</a></span>
<span class="contSub"><a href="#Escaping%32and%32filtering%32contexts_CSS%32comment">CSS comment</a></span>
<span class="contSub"><a href="#Escaping%32and%32filtering%32contexts_Javascript">Javascript</a></span>
<span class="contSub"><a href="#Escaping%32and%32filtering%32contexts_Javascript%32string">Javascript string</a></span>
<span class="contSub"><a href="#Escaping%32and%32filtering%32contexts_Javascript%32comment">Javascript comment</a></span>
</div>
<div class="contItem"><a href="#Escaping%32and%32filtering%32rules">Escaping and filtering rules</a></div>
<div class="contLead">
<span class="contSub"><a href="#Escaping%32and%32filtering%32rules_HTML%45escape">HTML-escape</a></span>
<span class="contSub"><a href="#Escaping%32and%32filtering%32rules_HTML%45data%45escape">HTML-data-escape</a></span>
<span class="contSub"><a href="#Escaping%32and%32filtering%32rules_HTML%45tagname%45escape">HTML-tagname-escape</a></span>
<span class="contSub"><a href="#Escaping%32and%32filtering%32rules_HTML%45attributes%45escape">HTML-attributes-escape</a></span>
<span class="contSub"><a href="#Escaping%32and%32filtering%32rules_HTML%45attr%45value%45escape">HTML-attr-value-escape</a></span>
<span class="contSub"><a href="#Escaping%32and%32filtering%32rules_HTML%45attr%45nospace%45escape">HTML-attr-nospace-escape</a></span>
<span class="contSub"><a href="#Escaping%32and%32filtering%32rules_URL%45escape">URL-escape</a></span>
<span class="contSub"><a href="#Escaping%32and%32filtering%32rules_URL%45param%45escape">URL-param-escape</a></span>
<span class="contSub"><a href="#Escaping%32and%32filtering%32rules_CSS%45escape">CSS-escape</a></span>
<span class="contSub"><a href="#Escaping%32and%32filtering%32rules_CSS%45string%45escape">CSS-string-escape</a></span>
<span class="contSub"><a href="#Escaping%32and%32filtering%32rules_CSS%45comment%45escape">CSS-comment-escape</a></span>
<span class="contSub"><a href="#Escaping%32and%32filtering%32rules_Javascript%45escape">Javascript-escape</a></span>
<span class="contSub"><a href="#Escaping%32and%32filtering%32rules_Javascript%45string%45escape">Javascript-string-escape</a></span>
<span class="contSub"><a href="#Escaping%32and%32filtering%32rules_Javascript%45comment%45escape">Javascript-comment-escape</a></span>
</div>
<div class="topItem"><a href="#Controllers">Controllers</a></div>
<div class="contItem"><a href="#zcontroller%32attribute">zcontroller attribute</a></div>
<div class="contItem"><a href="#zaction%32attribute">zaction attribute</a></div>
<div class="contItem"><a href="#action%32method">action method</a></div>
<div class="contItem"><a href="#Passing%32data">Passing data</a></div>
<div class="topItem"><a href="#Copyright">Copyright</a></div>


<div class="sep1"></div>
<a name="ZUT%32File"></a><h1>ZUT File</h1>

<p>A Zimbu Template is specified in a ZUT file.
</p>

<p>Example:
<pre class='vimCodeElement'>
<span class="Comment"># Description of what this template is for.</span>
<span class="Comment"># Copyright, license.</span>

<span class="Comment"># Include another module.</span>
<span class="Statement">IMPORT</span> Colors.zu

<span class="Comment"># A module is used as a namespace for what follows.</span>
<span class="Statement">MODULE</span> MyTemplate

  <span class="Comment"># Methods and declarations go here.</span>

  <span class="Comment"># CSS that applies to all the templates below.</span>
  <span class="Statement">CSS</span>
    <span class="Identifier">.</span><span class="Identifier">hello</span> <span class="Identifier">{</span>
      <span class="Type">color</span>: <span class="PreProc">[=</span>Colors.foreground<span class="PreProc">]</span>;<span class="Comment">  # get color from imported module</span>
    <span class="Identifier">}</span>
  <span class="Statement">}</span>

  <span class="Comment"># This is a template that produces HTML. The syntax resembles a function</span>
  <span class="Comment"># call, the return type specifies what it produces.</span>
  <span class="Comment"># When this template is used, the CSS above will be automatically included.</span>
  <span class="Statement">TEMPLATE</span> message(<span class="Type">string</span> text) <span class="PreProc">ZUT</span>.Html
    <span class="Identifier">&lt;</span><span class="Statement">div</span><span class="Identifier"> </span><span class="Type">class</span><span class="Identifier">=</span><span class="Constant">&quot;hello&quot;</span><span class="Identifier">&gt;</span>
      <span class="PreProc">[=</span>text<span class="PreProc">]</span><span class="Comment">  # the text will be HTML-escaped</span>
    <span class="Identifier">&lt;/</span><span class="Statement">div</span><span class="Identifier">&gt;</span>
  <span class="Statement">}</span>
<span class="Statement">}</span>
</pre>
</p>

<p>A ZUT file is always UTF-8 encoded.
</p>

<p>The file name must end in ".zut".
</p>

<p>The file name up to ".zut" must match the module in the file.
</p>


<div class="sep2"></div>
<a name="Preprocessing"></a><h2>Preprocessing</h2>

<p>This is the same as for a Zimbu file, see zimbu.html.
Note that Tab characters are not allowed.
</p>


<div class="sep2"></div>
<a name="File%32Level"></a><h2>File Level</h2>

<p>The ZUT file toplevel is equal to a Zimbu file for a module.
</p>

<p>Inside the module there are two special items that do not appear in a Zimbu
file: CSS and TEMPLATE.
</p>


<div class="sep2"></div>
<a name="Comments"></a><h2>Comments</h2>

<p>The Zimbu-style comment, starting with # and continuing until the end of the
line, can be used anywhere.  They are stripped out before producing the
generated CSS, HTML, et al.
</p>

<p>To avoid # to be recognized as the start of a comment accidentally, it is
required to have two spaces before it, or have the # appear as the first
non-white character in the line.  Additionally, a space must follow right after the #.
</p>

<p>To insert a literal # in the html where it would be recognized as a comment use
["#"].
</p>

<pre class='vimCodeElement'>
  <span class="Comment"># Comment</span>
  <span class="Statement">CSS</span>
  <span class="Comment">  # This is a comment, but the next line is not.</span>
    <span class="Identifier">#id</span> <span class="Identifier">{</span>
      <span class="Type">color</span>: <span class="Constant">#</span><span class="Constant">555</span>;<span class="Comment">  # Note the two spaces before this comment</span>
    <span class="Identifier">}</span>
  <span class="Statement">}</span>
  <span class="Statement">TEMPLATE</span> show(<span class="Type">string</span> text) <span class="PreProc">ZUT</span>.Html <span class="PreProc">@public</span>
    <span class="Identifier">&lt;</span><span class="Statement">div</span><span class="Identifier">&gt;</span>
    <span class="Comment">  # This is a comment.</span>
      #Not a comment
      <span class="PreProc">[</span><span class="Constant">&quot;#&quot;</span><span class="PreProc">]</span> Also not a comment
    <span class="Identifier">&lt;/</span><span class="Statement">div</span><span class="Identifier">&gt;</span>
  <span class="Statement">}</span>
</pre>

<p>CSS and HTML comments can also be used where they are valid, these are kept in
the generated CSS and HTML.
</p>


<div class="sep2"></div>
<a name="Special%32characters"></a><h2>Special characters</h2>

<p>Some characters have a special meaning.  To insert them literally use a [""]
block.  These characters need to be escaped:
</p>

<table cellpadding=0 cellspacing=0 border=0>
<tr valign="top"><td class="firstcol">}</td><td class="col">["}"]</td><td class="col">end of a TEMPLATE</td></tr>
<tr valign="top"><td class="firstcol">[</td><td class="col">["["]</td><td class="col">start of a Zimbu statement or expression</td></tr>
<tr valign="top"><td class="firstcol">#</td><td class="col">["#"]</td><td class="col">comment</td></tr>
<tr valign="top"><td class="firstcol"> </td><td class="col">[" "]</td><td class="col">space</td></tr>
<tr valign="top"><td class="firstcol"> </td><td class="col">["\n"]</td><td class="col">line break</td></tr>
</td></tr></table>

<p>Note how [}] differs from ["}"].  [}] is used as the end of a code block, it is
part of the generated Zimbu statements.
["}"] inserts a literal }, it is part of the produced HTML.
</p>

<p>Any text can be used inside the quotes, but it is best to only use it for
special characters.
</p>


<div class="sep2"></div>
<a name="White%32space%32removal"></a><h2>White space removal</h2>

<p>In many places white space is removed where it is not needed in the output.
This applies to spaces and line breaks.
</p>

<p>Usually the indent is dropped, allowing the templates to add indent to follow
the element structure.
</p>

<p>Trailing white space is removed before a Zimbu statement.
</p>

<p>When white space is removed where it should be kept, use special character.
For a single space: [" "]
</p>


<div class="sep1"></div>
<a name="CSS%32template%32%45%32ZUT%46Css"></a><h1>CSS template - ZUT.Css</h1>

<div class="sep2"></div>
<a name="nameless%32CSS%32block"></a><h2>nameless CSS block</h2>

<p>A CSS block defines the Cascading Style Sheets used for the templates in this
module. It ends at the matching }.
</p>

<p>The syntax is just like a style tag in HTML, with the addition of the ZUT items
in square brackets and the Zimbu style comments. 
</p>

<p>This block does not have arguments, since it's not called from code you write.
It can use expressions that use variables in the module and any imported
modules.
</p>

<a name="nameless%32CSS%32block_Example"></a><h3>Example</h3>

<pre class='vimCodeElement'>
  <span class="Type">string</span> myColor = <span class="Constant">&quot;black&quot;</span>

  <span class="Statement">CSS</span>
    <span class="Identifier">.</span><span class="Identifier">hello</span> <span class="Identifier">{</span>
      <span class="Type">color</span>: <span class="PreProc">[=</span>myColor<span class="PreProc">]</span>;<span class="Comment">  # uses the value of the myColor variable</span>
    <span class="Identifier">}</span>
  <span class="Statement">}</span>
</pre>

<p>When a template in the same ZUT file is used the nameless CSS block is
automatically added to the page.  On the server all the CSS of all the used
templates is concatenated and results in one "style" element.  In the browser
every CSS block is added as a separate "style" element.  Each CSS block is
added only once.
</p>


<div class="sep2"></div>
<a name="CSS%32template"></a><h2>CSS template</h2>

<p>CSS can also be produced with a TEMPLATE that returns ZUT.Css.  This CSS is not
automatically included, templates that use this CSS must explicitly state this
with a CSS statement.  Another difference with a CSS block is that arguments
can be passed in.
</p>

<a name="CSS%32template_Example"></a><h3>Example</h3>

<pre class='vimCodeElement'>
  <span class="Statement">TEMPLATE</span> classColor(<span class="Type">string</span> name, <span class="Type">string</span> color) <span class="PreProc">ZUT</span>.Css <span class="PreProc">@public</span>
    .<span class="PreProc">[=</span>name<span class="PreProc">]</span> <span class="Identifier">{</span>
      <span class="Type">color</span>: <span class="PreProc">[=</span>color<span class="PreProc">]</span>;
    <span class="Identifier">}</span>
  <span class="Statement">}</span>
  <span class="Statement">TEMPLATE</span> titleDiv(<span class="Type">string</span> text, <span class="Type">string</span> color) <span class="PreProc">ZUT</span>.Html <span class="PreProc">@public</span>
    <span class="PreProc">[</span><span class="PreProc">ZUT</span>.addCss(<span class="Constant">&quot;title/&quot;</span> .. color, classColor(<span class="Constant">&quot;title&quot;</span>, color))<span class="PreProc">]</span>
    <span class="Identifier">&lt;</span><span class="Statement">div</span><span class="Identifier"> </span><span class="Type">class</span><span class="Identifier">=</span><span class="Constant">&quot;title&quot;</span><span class="Identifier">&gt;</span>
      <span class="PreProc">[=</span>text<span class="PreProc">]</span>
    <span class="Identifier">&lt;/</span><span class="Statement">div</span><span class="Identifier">&gt;</span>
  <span class="Statement">}</span>
</pre>

<p>To include a CSS template where it is needed, use the ZUT.addCss method.
This is the relevant line:
<pre class='vimCodeElement'>
    <span class="PreProc">[</span><span class="PreProc">ZUT</span>.addCss(<span class="Constant">&quot;title/&quot;</span> .. color, classColor(<span class="Constant">&quot;title&quot;</span>, color))<span class="PreProc">]</span>
</pre>
</p>

<p>The first argument is the name of the style element.  If this name
was encountered before the CSS will not be added again.  In the example the
name is the concatenation of the class name and the color value.  If this
combination is encountered a second time the style was already defined and will
not be added again.
</p>

<p>The name can be NIL to add the style unconditionally.  Only do this for
templates that are used once.
</p>

<p>The second argument is an expression resulting in a ZUT.Css object, usually by
invoking a template.
</p>

<p>The ZUT.addCss method can be used in Zimbu code just like it is used here.
</p>


<div class="sep1"></div>
<a name="HTML%32template%32%45%32ZUT%46Html"></a><h1>HTML template - ZUT.Html</h1>

<p>A TEMPLATE returning ZUT.Html defines a HTML template.  The syntax is similar
to a Zimbu method, with a name and arguments inside parenthesis, the return
type followed by optional attributes.  It ends at the matching }.
</p>

<a name="HTML%32template%32%45%32ZUT%46Html_Example"></a><h3>Example</h3>

<pre class='vimCodeElement'>
  <span class="Statement">TEMPLATE</span> show(<span class="Type">string</span> text) <span class="PreProc">ZUT</span>.Html <span class="PreProc">@public</span>
    <span class="Identifier">&lt;</span><span class="Statement">div</span><span class="Identifier"> </span><span class="Type">class</span><span class="Identifier">=</span><span class="Constant">&quot;hello&quot;</span><span class="Identifier">&gt;</span>
      <span class="PreProc">[=</span>text<span class="PreProc">]</span>
    <span class="Identifier">&lt;/</span><span class="Statement">div</span><span class="Identifier">&gt;</span>
  <span class="Statement">}</span>
</pre>

<p>The syntax of the contents is just like HTML, with the addition of the ZUT
items in square brackets, the Zimbu style comments, and the special meaning of
"zcontroller" and "zaction" attributes. 
</p>

<p>The name of the template must start with a lower case letter, just like a Zimbu
method.
</p>

<p>The arguments are specified with their type. Optional arguments are allowed,
again just like with Zimbu methods.
</p>

<p>The returned ZUT.Html object is more or less a string with the produced HTML.
The ZUT.Html type is used to have the compiler check for proper escaping.
</p>

<p>The validity of the produced HTML is not verified.  It is possible to have one
HTML template that contains <div> and another one that contains </div> and
concatenate them later.
</p>


<div class="sep1"></div>
<a name="Attributes%32template%32%45%32ZUT%46Attributes"></a><h1>Attributes template - ZUT.Attributes</h1>

<p>An attributes template is like a HTML template, but instead of HTML elements it
only contains the attributes for an HTML element.  The return type is
ZUT.Attributes.
</p>

<p>This is useful to generate attributes that are added in multiple elements.
Especially as used in the decorator of a controller.
</p>

<a name="Attributes%32template%32%45%32ZUT%46Attributes_Example"></a><h3>Example</h3>

<pre class='vimCodeElement'>
  <span class="Statement">TEMPLATE</span> fancy() <span class="PreProc">ZUT</span>.Attributes <span class="PreProc">@public</span>
    class=&quot;fancy-text&quot;
  <span class="Statement">}</span>
</pre>


<div class="sep1"></div>
<a name="URL%32template%32%45%32ZUT%46Url"></a><h1>URL template - ZUT.Url</h1>

<p>A URL template is like a HTML template, but instead of HTML elements it only
contains a URL.  The return type is ZUT.Url.
</p>

<p>This is useful to generate a URL that is used in another template.
</p>

<a name="URL%32template%32%45%32ZUT%46Url_Example"></a><h3>Example</h3>

<pre class='vimCodeElement'>
  <span class="Statement">TEMPLATE</span> link(<span class="Type">string</span> domain, <span class="Type">string</span> path, <span class="Type">string</span> param) <span class="PreProc">ZUT</span>.Url <span class="PreProc">@public</span>
    <span class="PreProc">[=</span>domain<span class="PreProc">]</span>/<span class="PreProc">[=</span>path<span class="PreProc">]</span>?<span class="PreProc">[=</span>param<span class="PreProc">]</span><span class="Comment">  # Special characters will be Url-escaped.</span>
  <span class="Statement">}</span>
</pre>


<div class="sep1"></div>
<a name="Text%32template"></a><h1>Text template</h1>

<p>A text template is like a HTML template, but instead of HTML elements it only
contains plain, unescaped text.  The return type is string.
</p>

<p>This is useful to generate text that is used in another template or as the
value of a text area.  The parameters do not get escaped.
</p>

<a name="Text%32template_Example"></a><h3>Example</h3>

<pre class='vimCodeElement'>
  <span class="Statement">TEMPLATE</span> fancy(<span class="Type">string</span> title) <span class="Type">string</span> <span class="PreProc">@public</span>
    Title: <span class="PreProc">[=</span>title<span class="PreProc">]</span><span class="Comment">  # Special characters in |title| are not escaped.</span>
  <span class="Statement">}</span>
</pre>

<a name="Text%32template_No%32escaping"></a><h3>No escaping</h3>

<p>While other template types have escaping rules, the text template does not
escape anything.  The escaping will happen when using the result of the
template in another template.
</p>

<p>Keep in mind there also is no un-escaping.  For example, when passing in a
ZUT.Html argument it is turned into a string.  If then using the result of the
text template in another HTML template special characters will be
escaped twice.
</p>

<p>Example:
<pre class='vimCodeElement'>
  <span class="Statement">TEMPLATE</span> titleHeader(<span class="PreProc">ZUT</span>.Html title) <span class="Type">string</span>
    Title: <span class="PreProc">[=</span>title<span class="PreProc">]</span>
  <span class="Statement">}</span>
  <span class="Statement">TEMPLATE</span> titleDiv(<span class="PreProc">ZUT</span>.Html title) <span class="PreProc">ZUT</span>.Html <span class="PreProc">@public</span>
    <span class="Identifier">&lt;</span><span class="Statement">div</span><span class="Identifier">&gt;</span><span class="PreProc">[=</span>titleHeader(title)<span class="PreProc">]</span><span class="Identifier">&lt;/</span><span class="Statement">div</span><span class="Identifier">&gt;</span>
  <span class="Statement">}</span>
</pre>
</p>

<p>If title is "this &amp; that", when used as HTML it would be displayed as "this
&amp;that". When passed to the titleHeader template, it will return "this &amp;
that" as a text string, no escaping or un-escaping takes place.
Inside titleDiv the result of titleHeader is a string, which will be escaped,
resulting in "this &amp;amp; that", which shows up as "this &amp; that"
</p>


<div class="sep1"></div>
<a name="Javascript%32template%32%45%32ZUT%46Javascript"></a><h1>Javascript template - ZUT.Javascript</h1>

<p>A Javascript template is like a HTML template, but instead of HTML elements it
only contains Javascript.  The return type is ZUT.Javascript.
</p>

<p>This is useful to generate a Javascript that is used in a &lt;script&gt; tag.
Escaping makes sure that the script is not terminated early by a
&lt;/script&gt; end tag somewhere.
</p>

<a name="Javascript%32template%32%45%32ZUT%46Javascript_Example"></a><h3>Example</h3>

<pre class='vimCodeElement'>
  <span class="Statement">TEMPLATE</span> onclick(<span class="Type">string</span> <span class="Type">func</span>, <span class="Type">string</span> arg) <span class="PreProc">ZUT</span>.Javascript <span class="PreProc">@public</span>
    <span class="PreProc">[=</span><span class="Type">func</span><span class="PreProc">]</span>(<span class="PreProc">[=</span>arg<span class="PreProc">]</span>)<span class="Comment">  # Special characters will be escaped.</span>
  <span class="Statement">}</span>
</pre>


<div class="sep1"></div>
<a name="ZUT%46Context"></a><h1>ZUT.Context</h1>

<p>The context "ZUT.Context" is available with:
<pre class='vimCodeElement'>
  <span class="Type">VAR</span> context = <span class="PreProc">CTX</span>.get(<span class="PreProc">ZUT</span>.Context.Type())
</pre>
</p>

<p>On the server it provides information about the Http request.  In the browser
it provides information about the browser.
</p>


<div class="sep1"></div>
<a name="Template%32items"></a><h1>Template items</h1>

<div class="sep2"></div>
<a name="Zimbu%32statement"></a><h2>Zimbu statement</h2>

<p>In CSS and TEMPLATE Zimbu statements can be used in square brackets.
For example, to get a unique ID to use:
<pre class='vimCodeElement'>
  <span class="Statement">TEMPLATE</span> message() <span class="PreProc">ZUT</span>.Html
    <span class="PreProc">[</span><span class="Type">string</span> helloId = <span class="PreProc">ZUT</span>.uid()<span class="PreProc">]</span>
    <span class="Identifier">&lt;</span><span class="Statement">div</span><span class="Identifier"> </span><span class="Type">id</span><span class="Identifier">=</span><span class="Constant">[=helloId]</span><span class="Identifier">&gt;</span>Hello!<span class="Identifier">&lt;/</span><span class="Statement">div</span><span class="Identifier">&gt;</span>
  <span class="Statement">}</span>
</pre>
</p>

<p>It does not have to be a complete statement, it can also be one line of a
multi-line statement.  For example, an IF statement can be used to select what
HTML to produce:
<pre class='vimCodeElement'>
  <span class="Statement">TEMPLATE</span> message(<span class="Type">bool</span> useDiv) <span class="PreProc">ZUT</span>.Html
    <span class="PreProc">[</span><span class="Statement">IF</span> useDiv<span class="PreProc">]</span>
      <span class="Identifier">&lt;</span><span class="Statement">div</span><span class="Identifier">&gt;</span>Hello<span class="Identifier">&lt;/</span><span class="Statement">div</span><span class="Identifier">&gt;</span>
    <span class="PreProc">[</span><span class="Statement">ELSE</span><span class="PreProc">]</span>
      <span class="Identifier">&lt;</span><span class="Statement">span</span><span class="Identifier">&gt;</span>Hello<span class="Identifier">&lt;/</span><span class="Statement">span</span><span class="Identifier">&gt;</span>
    <span class="PreProc">[</span><span class="Statement">}</span><span class="PreProc">]</span>
  <span class="Statement">}</span>
</pre>
</p>

<p>The template arguments can be used.  Variable names starting with "zut" are
reserved for internal use.
</p>

<p>Although there are no restrictions on what statements you can use here, avoid
putting to much functionality into the template.  It is best restricted to
calls invoking methods which are implemented in a Zimbu file.
</p>


<div class="sep2"></div>
<a name="Zimbu%32expression"></a><h2>Zimbu expression</h2>

<p>In CSS and TEMPLATE blocks a ZUT expression can be used to insert the result of
that expression.  It has the form "[=expr]".  The type of the result should be a
string or a ZUT object.  Other types are converted to a string by invoking
their ToString() method.
</p>

<p>Depending on the type and where it is used the proper escaping will be
automatically performed.  This prevents XSS security problems.
</p>

<p>A typical form of such an expression is invoking a template.  Example:
<pre class='vimCodeElement'>
  <span class="Statement">TEMPLATE</span> button(<span class="Type">bool</span> big, <span class="Type">string</span> text) <span class="PreProc">ZUT</span>.Html <span class="PreProc">@public</span>
    <span class="PreProc">[</span><span class="Statement">IF</span> big<span class="PreProc">]</span>
      <span class="PreProc">[=</span>MyButtons.bigButton(text)<span class="PreProc">]</span>
    <span class="PreProc">[</span><span class="Statement">ELSE</span><span class="PreProc">]</span>
      <span class="PreProc">[=</span>MyButtons.smallButton(text)<span class="PreProc">]</span>
    <span class="PreProc">[</span><span class="Statement">}</span><span class="PreProc">]</span>
  <span class="Statement">}</span>
</pre>
</p>

<p>Note that the expression is supposed to only contain text that is appropriate
for the context.  E.g., it should not start an element but not end it, or
terminate a string.  The escaping rules prevent this from happening.
</p>

<p>Example that doesn't work:
</p>

<pre class='vimCodeElement'>
  <span class="Statement">TEMPLATE</span> head() <span class="PreProc">ZUT</span>.Html
    <span class="Identifier">&lt;</span><span class="Statement">style</span><span class="Identifier">&gt;</span><span class="Comment">  # this doesn't work</span>
  <span class="Error">}</span>
  TEMPLATE tail() ZUT<span class="Identifier">.</span><span class="Identifier">Html</span>
    <span class="Identifier">&lt;/</span><span class="Statement">style</span><span class="Identifier">&gt;</span><span class="Comment">  # this doesn't work</span>
  <span class="Statement">}</span>
  <span class="Statement">TEMPLATE</span> whole(<span class="Type">string</span> myStyle) <span class="PreProc">ZUT</span>.Html
    <span class="PreProc">[=</span>head()<span class="PreProc">]</span>
    <span class="PreProc">[=</span>myStyle<span class="PreProc">]</span>
    <span class="PreProc">[=</span>tail()<span class="PreProc">]</span>
  <span class="Statement">}</span>
</pre>

<p>The problem here is that where "text" is used we can't know we are in the style
element, which requires different escaping.
</p>


<div class="sep2"></div>
<a name="Escaping%32and%32filtering%32contexts"></a><h2>Escaping and filtering contexts</h2>

<p>Cross-site scripting (XSS) vulnerabilities are a main cause for security
problems in websites.  This basically means that a hacker can inject code on a
web page, using the users's authentication to steal information or even change
it.
</p>

<p>ZUT tries hard to avoid XSS by filtering out text that shouldn't be there and
escaping text that might cause problems.  This is similar to strict
autoescaping in Google Closure templates.
</p>

<p>The plain text in the template is not filtered or escaped.  Thus you still have
to make sure that this text is correct.  What is escaped is what is inserted
from expressions.  How this happens depends on the context, where the
expression is used, and on the result type of the expression.
</p>

<p>The following sections list the filtering and escaping rules used for every
known context, depending on the expression result type.  Keep in mind that
"string" is often used for a type that is not listed if the expression result
is converted to a string with the ToString() method.
</p>

<p>If the expression appears in a place that is not any of the mentioned contexts,
then this is a compile time error.
</p>

<p>The escaping rules themselves are explained in the
<a href="#Escaping%32and%32filtering%32rules">next section</a>.
</p>

<p>Overview:
</p>

<table cellpadding=3 cellspacing=0 border=1>
<tr class="firstrow" valign="top"><td class="firstcol">Context                     </td><td class="col">string</td><td class="col">Html</td><td class="col">Url</td><td class="col">Attributes</td><td class="col">Css</td><td class="col">Javascript</td></tr>
<tr valign="top"><td class="firstcol"><a href="#Escaping%32and%32filtering%32contexts_HTML">HTML</a>                                </td><td class="col"><a href="#Escaping%32and%32filtering%32rules_HTML%45escape">escape</a></td><td class="col"><b>as-is</b></td><td class="col"><a href="#Escaping%32and%32filtering%32rules_HTML%45escape">escape</a></td><td class="col">error</td><td class="col">error</td><td class="col">error</td></tr>
<tr valign="top"><td class="firstcol"><a href="#Escaping%32and%32filtering%32contexts_HTML%32data">HTML data</a>                      </td><td class="col"><a href="#Escaping%32and%32filtering%32rules_HTML%45escape">escape</a></td><td class="col"><a href="#Escaping%32and%32filtering%32rules_HTML%45data%45escape">escape</a></td><td class="col"><a href="#Escaping%32and%32filtering%32rules_HTML%45escape">escape</a></td><td class="col">error</td><td class="col">error</td><td class="col">error</td></tr>
<tr valign="top"><td class="firstcol"><a href="#Escaping%32and%32filtering%32contexts_HTML%32tag%32name">HTML tag name</a>              </td><td class="col"><a href="#Escaping%32and%32filtering%32rules_HTML%45tagname%45escape">escape</a></td><td class="col">error</td><td class="col">error</td><td class="col">error</td><td class="col">error</td><td class="col">error</td></tr>
<tr valign="top"><td class="firstcol"><a href="#Escaping%32and%32filtering%32contexts_HTML%32attributes">HTML attributes</a>            </td><td class="col"><a href="#Escaping%32and%32filtering%32rules_HTML%45attributes%45escape">escape</a></td><td class="col">error</td><td class="col">error</td><td class="col"><b>as-is</b></td><td class="col">error</td><td class="col">error</td></tr>
<tr valign="top"><td class="firstcol"><a href="#Escaping%32and%32filtering%32contexts_HTML%32attribute%32value">HTML attribute value</a></td><td class="col"><a href="#Escaping%32and%32filtering%32rules_HTML%45attr%45value%45escape">escape</a></td><td class="col">error</td><td class="col"><a href="#Escaping%32and%32filtering%32rules_HTML%45attr%45value%45escape">escape</a></td><td class="col">error</td><td class="col">error</td><td class="col">error</td></tr>
<tr valign="top"><td class="firstcol"><a href="#Escaping%32and%32filtering%32contexts_HTML%32style%32attribute%32value">HTML style attribute value</a></td><td class="col"><a href="#Escaping%32and%32filtering%32rules_HTML%45attr%45value%45escape">escape</a></td><td class="col">error</td><td class="col">error</td><td class="col">error</td><td class="col"><a href="#Escaping%32and%32filtering%32rules_HTML%45attr%45value%45escape">escape</a></td><td class="col">error</td></tr>
<tr valign="top"><td class="firstcol"><a href="#Escaping%32and%32filtering%32contexts_HTML%32style%32attribute%32value">HTML script attribute value</a></td><td class="col"><a href="#Escaping%32and%32filtering%32rules_HTML%45attr%45value%45escape">escape</a></td><td class="col">error</td><td class="col">error</td><td class="col">error</td><td class="col">error</td><td class="col"><a href="#Escaping%32and%32filtering%32rules_HTML%45attr%45value%45escape">escape</a></td></tr>
<tr valign="top"><td class="firstcol"><a href="#Escaping%32and%32filtering%32contexts_HTML%32unquoted%32attribute%32value">HTML unquoted attribute value</a></td><td class="col"><a href="#Escaping%32and%32filtering%32rules_HTML%45attr%45nospace%45escape">escape</a></td><td class="col">error</td><td class="col"><a href="#Escaping%32and%32filtering%32rules_HTML%45attr%45nospace%45escape">escape</a></td><td class="col">error</td><td class="col">error</td><td class="col">error</td></tr>
<tr valign="top"><td class="firstcol"><a href="#Escaping%32and%32filtering%32contexts_URL">URL</a>                                  </td><td class="col"><a href="#Escaping%32and%32filtering%32rules_URL%45escape">escape</a></td><td class="col">error</td><td class="col"><b>as-is</b> or <a href="#Escaping%32and%32filtering%32rules_URL%45param%45escape">escape</a></td><td class="col">error</td><td class="col">error</td><td class="col">error</td></tr>
<tr valign="top"><td class="firstcol"><a href="#Escaping%32and%32filtering%32contexts_CSS">CSS</a>                                  </td><td class="col"><a href="#Escaping%32and%32filtering%32rules_CSS%45escape">escape</a></td><td class="col">error</td><td class="col">error</td><td class="col">error</td><td class="col"><b>as-is</b></td><td class="col">error</td></tr>
<tr valign="top"><td class="firstcol"><a href="#Escaping%32and%32filtering%32contexts_CSS%32string">CSS string</a>                    </td><td class="col"><a href="#Escaping%32and%32filtering%32rules_CSS%45string%45escape">escape</a></td><td class="col">error</td><td class="col">error</td><td class="col">error</td><td class="col">error</td><td class="col">error</td></tr>
<tr valign="top"><td class="firstcol"><a href="#Escaping%32and%32filtering%32contexts_CSS%32URL">CSS URL</a>                          </td><td class="col"><a href="#Escaping%32and%32filtering%32rules_URL%45escape">escape</a></td><td class="col">error</td><td class="col"><b>as-is</b> or <a href="#Escaping%32and%32filtering%32rules_URL%45param%45escape">escape</a></td><td class="col">error</td><td class="col">error</td><td class="col">error</td></tr>
<tr valign="top"><td class="firstcol"><a href="#Escaping%32and%32filtering%32contexts_CSS%32comment">CSS comment</a>            </td><td class="col"><a href="#Escaping%32and%32filtering%32rules_CSS%45comment%45escape">escape</a></td><td class="col"><a href="#Escaping%32and%32filtering%32rules_CSS%45comment%45escape">escape</a></td><td class="col"><a href="#Escaping%32and%32filtering%32rules_CSS%45comment%45escape">escape</a></td><td class="col"><a href="#Escaping%32and%32filtering%32rules_CSS%45comment%45escape">escape</a></td><td class="col"><a href="#Escaping%32and%32filtering%32rules_CSS%45comment%45escape">escape</a></td><td class="col"><a href="#Escaping%32and%32filtering%32rules_CSS%45comment%45escape">escape</a></td></tr>
<tr valign="top"><td class="firstcol"><a href="#Escaping%32and%32filtering%32contexts_Javascript">Javascript</a>                    </td><td class="col"><a href="#Escaping%32and%32filtering%32rules_Javascript%45escape">escape</a></td><td class="col">error</td><td class="col">error</td><td class="col">error</td><td class="col">error</td><td class="col"><b>as-is</b></td></tr>
<tr valign="top"><td class="firstcol"><a href="#Escaping%32and%32filtering%32contexts_Javascript%32string">Javascript string</a>             </td><td class="col"><a href="#Escaping%32and%32filtering%32rules_Javascript%45string%45escape">escape</a></td><td class="col">error</td><td class="col"><a href="#Escaping%32and%32filtering%32rules_Javascript%45string%45escape">escape</a></td><td class="col">error</td><td class="col">error</td><td class="col">error</td></tr>
<tr valign="top"><td class="firstcol"><a href="#Escaping%32and%32filtering%32contexts_Javascript%32comment">Javascript comment</a>            </td><td class="col"><a href="#Escaping%32and%32filtering%32rules_Javascript%45comment%45escape">escape</a></td><td class="col"><a href="#Escaping%32and%32filtering%32rules_Javascript%45comment%45escape">escape</a></td><td class="col"><a href="#Escaping%32and%32filtering%32rules_Javascript%45comment%45escape">escape</a></td><td class="col"><a href="#Escaping%32and%32filtering%32rules_Javascript%45comment%45escape">escape</a></td><td class="col"><a href="#Escaping%32and%32filtering%32rules_Javascript%45comment%45escape">escape</a></td><td class="col"><a href="#Escaping%32and%32filtering%32rules_Javascript%45comment%45escape">escape</a></td></tr>
</td></tr></table>


<p>"error" means that there will be a compile time error.
</p>

<p>Expressions of type int and float are converted to string and handled like
string.
</p>


<a name="Escaping%32and%32filtering%32contexts_HTML"></a><h3>HTML</h3>

<p>Let's start with a very common context: In a HTML template, not inside a tag,
inside a normal element.
</p>

<pre class='vimCodeElement'>
  <span class="Statement">TEMPLATE</span> sections(SomeType here) <span class="PreProc">ZUT</span>.Html <span class="PreProc">@public</span>
    <span class="PreProc">[=</span>here<span class="PreProc">]</span>
    <span class="Identifier">&lt;</span><span class="Statement">div</span><span class="Identifier">&gt;</span>or <span class="PreProc">[=</span>here<span class="PreProc">]</span><span class="Identifier">&lt;/</span><span class="Statement">div</span><span class="Identifier">&gt;</span>
    <span class="Identifier">&lt;</span><span class="Statement">div</span><span class="Identifier">&gt;</span>and <span class="PreProc">[=</span>here<span class="PreProc">]</span> too<span class="Identifier">&lt;/</span><span class="Statement">div</span><span class="Identifier">&gt;</span>
  <span class="Statement">}</span>
</pre>

<p>Inside some elements, such as title, the HTML data context applies,
see the
<a href="#Escaping%32and%32filtering%32contexts_HTML%32data">next section</a>.
</p>

<p>Inside style elements the
<a href="#Escaping%32and%32filtering%32contexts_CSS">CSS context</a>.
applies.
</p>

<p>Inside script elements the
<a href="#Escaping%32and%32filtering%32contexts_Javascript">Javascript context</a>.
applies.
</p>

<h4>string</h4>

<p>A string in HTML context uses the
<a href="#Escaping%32and%32filtering%32rules_HTML%45escape">HTML-escape</a> rule,
so that the literal text will be displayed.
</p>

<p>Any type not specifically recognized is converted to a string with the
ToString() method.  This allows for many objects to be displayed in a
straightforward way.  For example, if the "here" argument in the sections
template above is a list of strings, it is displayed in the ["one", "two",
"three"] form.
</p>


<h4>ZUT.Html</h4>

<p>Since a ZUT.Html expression already is well-formed HTML, this is inserted
as-is.
</p>

<h4>ZUT.Css, ZUT.Attributes, ZUT.Javascript</h4>

<p>This is most likely a mistake in the template and results in a compilation error.
If you really want to insert this expression, convert it to string.  It
will then be escaped and show up as text.
</p>

<h4>ZUT.Url</h4>

<p>When a ZUT.Url is used where plain text is expected, we assume that the URL is
the be displayed literally.  Example:
</p>

<pre class='vimCodeElement'>
  <span class="Statement">TEMPLATE</span> urlWithText(<span class="PreProc">ZUT</span>.Url url) <span class="PreProc">ZUT</span>.Html <span class="PreProc">@public</span>
    <span class="Identifier">&lt;</span><span class="Statement">a</span><span class="Identifier"> </span><span class="Type">href</span><span class="Identifier">=</span><span class="Constant">&quot;[=url]&quot;</span><span class="Identifier">&gt;</span><span class="Underlined">[=url]</span><span class="Identifier">&lt;/</span><span class="Statement">a</span><span class="Identifier">&gt;</span>
  <span class="Statement">}</span>
</pre>

<p>The first use of "url" is escaped so that it can be clicked on (see the
<a href="#Escaping%32and%32filtering%32contexts_HTML%32attribute%32value">attribute value context</a>
below), the second one uses the
<a href="#Escaping%32and%32filtering%32rules_HTML%45escape">HTML-escape</a> rule,
so that it shows up literally.
</p>


<a name="Escaping%32and%32filtering%32contexts_HTML%32data"></a><h3>HTML data</h3>

<p>Inside some HTML tags the rules are different.
</p>

<pre class='vimCodeElement'>
  <span class="Statement">TEMPLATE</span> header(SomeType here) <span class="PreProc">ZUT</span>.Html <span class="PreProc">@public</span>
    <span class="Identifier">&lt;</span><span class="Statement">title</span><span class="Identifier">&gt;</span><span class="Title">[=here]</span><span class="Identifier">&lt;/</span><span class="Statement">title</span><span class="Identifier">&gt;</span>  <span class="Comment">  # HTML-escape</span>
  <span class="Statement">}</span>
</pre>


<h4>ZUT.Html</h4>

<p>Although ZUT.Html is already proper HTML, the title element does not
nest, therefore elements are escaped.  This uses the 
<a href="#Escaping%32and%32filtering%32rules_HTML%45data%45escape">HTML-data-escape</a> rule.
</p>

<h4>other types</h4>

<p>Everything else is handled like HTML, see above.
</p>


<a name="Escaping%32and%32filtering%32contexts_HTML%32tag%32name"></a><h3>HTML tag name</h3>

<p>This comes right after the &lt; that starts an opening tag, the &lt;/ that
starts a closing tag or the &lt;! that is used for DOCTYPE:
</p>

<pre class='vimCodeElement'>
  <span class="Statement">TEMPLATE</span> divOrSpan(<span class="Type">string</span> tagName) <span class="PreProc">ZUT</span>.Html <span class="PreProc">@public</span>
    <span class="Identifier">&lt;[=</span><span class="Constant">tagName]</span><span class="Identifier">&gt;</span>some text<span class="Identifier">&lt;/[=tagName]&gt;</span>
    <span class="Identifier">&lt;[=</span><span class="Constant">tagName]</span><span class="Identifier"> </span><span class="Type">class</span><span class="Identifier">=</span><span class="Constant">&quot;gold&quot;</span><span class="Identifier">&gt;</span>some text<span class="Identifier">&lt;/[=tagName]&gt;</span>
  <span class="Statement">}</span>
</pre>

<h4>string</h4>

<p>The string is only accepted if it is a normal tag name, otherwise a
ZUT.E_BadValue exeption is thrown.
See the <a href="#Escaping%32and%32filtering%32rules_HTML%45tagname%45escape">HTML-tagname-escape</a> rule.
</p>


<h4>ZUT.Html, ZUT.Attributes, ZUT.Javascript, ZUT.Url</h4>

<p>This is most likely a mistake in the template and resuls in a compilation error.
If you really want to insert this expression, convert it to string first.
</p>


<a name="Escaping%32and%32filtering%32contexts_HTML%32attributes"></a><h3>HTML attributes</h3>

<p>This is inside a tag, after the tag name:
</p>

<pre class='vimCodeElement'>
  <span class="Statement">TEMPLATE</span> something(SomeType attributes) <span class="PreProc">ZUT</span>.Html <span class="PreProc">@public</span>
    <span class="Identifier">&lt;</span><span class="Statement">div</span><span class="Identifier"> [=</span><span class="Constant">attributes]</span><span class="Identifier">&gt;</span>some text<span class="Identifier">&lt;/</span><span class="Statement">div</span><span class="Identifier">&gt;</span>
    <span class="Identifier">&lt;</span><span class="Statement">div</span><span class="Identifier"> </span><span class="Type">class</span><span class="Identifier">=</span><span class="Constant">&quot;nice&quot;</span><span class="Identifier"> [=</span><span class="Constant">attributes]</span><span class="Identifier">&gt;</span>some text<span class="Identifier">&lt;/</span><span class="Statement">div</span><span class="Identifier">&gt;</span>
    <span class="Identifier">&lt;</span><span class="Statement">div</span><span class="Identifier"> [=</span><span class="Constant">attributes]</span><span class="Identifier"> </span><span class="Type">id</span><span class="Identifier">=</span><span class="Constant">&quot;yes&quot;</span><span class="Identifier">&gt;</span>some text<span class="Identifier">&lt;/</span><span class="Statement">div</span><span class="Identifier">&gt;</span>
  <span class="Statement">}</span>
</pre>

<p>Note that it is not possible to use a Zimbu expression to set the attribute
name.  That is to avoid problems with escaping certain kinds of attributes.
</p>

<h4>ZUT.Attributes</h4>

<p>Since a ZUT.Attributes expression already is well-formed Attributes, this is
inserted as-is.
</p>

<h4>string</h4>

<p>Strings undergo the
<a href="#Escaping%32and%32filtering%32rules_HTML%45attributes%45escape">HTML-attributes-escape</a> rule,
to make sure only valid attributes are inserted.
</p>

<h4>other types</h4>

<p>No other type makes sense here and results in a compilation error.
</p>


<a name="Escaping%32and%32filtering%32contexts_HTML%32attribute%32value"></a><h3>HTML attribute value</h3>

<p>This is inside a tag, in the quoted argument of a normal parameter:
</p>

<pre class='vimCodeElement'>
  <span class="Statement">TEMPLATE</span> something(<span class="Type">string</span> className) <span class="PreProc">ZUT</span>.Html <span class="PreProc">@public</span>
    <span class="Identifier">&lt;</span><span class="Statement">div</span><span class="Identifier"> </span><span class="Type">class</span><span class="Identifier">=</span><span class="Constant">&quot;[=className]&quot;</span><span class="Identifier">&gt;</span>some text<span class="Identifier">&lt;/</span><span class="Statement">div</span><span class="Identifier">&gt;</span>
    <span class="Identifier">&lt;</span><span class="Statement">span</span><span class="Identifier"> </span><span class="Type">class</span><span class="Identifier">=</span><span class="Constant">'[=className]'</span><span class="Identifier">&gt;</span>some text<span class="Identifier">&lt;/</span><span class="Statement">span</span><span class="Identifier">&gt;</span>
  <span class="Statement">}</span>
</pre>

<p>For the "style" parameter the
<a href="#Escaping%32and%32filtering%32contexts_HTML%32style%32attribute%32value">HTML style attribute value</a>
context applies.
</p>

<p>For the parameters that have a Javascript value the
<a href="#Escaping%32and%32filtering%32contexts_HTML%32script%32attribute%32value">HTML script attribute value</a>
context applies.
</p>


<h4>string</h4>

<p>The attribute name matters here.  The escaping is different for URL attributes,
such as "href", which use the
<a href="#Escaping%32and%32filtering%32rules_URL%45escape">URL-escape</a> rule.
</p>

<p>Otherwise, encodes all special characters and quotes, but not spaces.  See the
<a href="#Escaping%32and%32filtering%32rules_HTML%45attr%45value%45escape">HTML-attr-value-escape</a>
rule.
</p>


<h4>ZUT.Url</h4>

<p>The Url is used as a string and the escaped like a string.  This prevents the special meaning of &amp;, among others.
</p>


<h4>other types</h4>

<p>No other type makes sense here and results in a compilation error.
</p>


<a name="Escaping%32and%32filtering%32contexts_HTML%32style%32attribute%32value"></a><h3>HTML style attribute value</h3>

<p>This is inside a style attribute of a tag.  This requires both escaping for the
style and the attribute value.
</p>

<pre class='vimCodeElement'>
  <span class="Statement">TEMPLATE</span> something(<span class="Type">string</span> css) <span class="PreProc">ZUT</span>.Html <span class="PreProc">@public</span>
    <span class="Identifier">&lt;</span><span class="Statement">div</span><span class="Identifier"> </span><span class="Type">style</span><span class="Identifier">=</span><span class="Constant">[=css]</span><span class="Identifier">&gt;</span>unquoted<span class="Identifier">&lt;/</span><span class="Statement">div</span><span class="Identifier">&gt;</span>
    <span class="Identifier">&lt;</span><span class="Statement">div</span><span class="Identifier"> </span><span class="Type">style</span><span class="Identifier">=</span><span class="Constant">&quot;[=css]&quot;</span><span class="Identifier">&gt;</span>quoted<span class="Identifier">&lt;/</span><span class="Statement">div</span><span class="Identifier">&gt;</span>
  <span class="Statement">}</span>
</pre>

<h4>string</h4>

<p>First applies the
<a href="#Escaping%32and%32filtering%32rules_CSS%45escape">CSS-escape</a> rule
and then on top of that the
<a href="#Escaping%32and%32filtering%32rules_HTML%45attr%45nospace%45escape">HTML-attr-nospace-escape</a> rule for an unquoted attribute or the 
<a href="#Escaping%32and%32filtering%32rules_HTML%45attributes%45escape">HTML-attributes-escape</a> rule for a quoted attribute.
</p>

<a name="Escaping%32and%32filtering%32contexts_ZUT%46Css"></a><h3>ZUT.Css</h3>

<p>Uses the properly formed CSS as-is, and applies the
<a href="#Escaping%32and%32filtering%32rules_HTML%45attr%45nospace%45escape">HTML-attr-nospace-escape</a> rule for an unquoted attribute or the 
<a href="#Escaping%32and%32filtering%32rules_HTML%45attributes%45escape">HTML-attributes-escape</a> rule for a quoted attribute.
</p>

<h4>other types</h4>

<p>No other type makes sense here and results in a compilation error.
</p>


<a name="Escaping%32and%32filtering%32contexts_HTML%32script%32attribute%32value"></a><h3>HTML script attribute value</h3>

<p>This is inside an attribute of a tag that uses Javascript, such as "onclick".
This requires both escaping for the Javascript and the attribute value.
</p>

<pre class='vimCodeElement'>
  <span class="Statement">TEMPLATE</span> something(<span class="Type">string</span> js) <span class="PreProc">ZUT</span>.Html <span class="PreProc">@public</span>
    <span class="Identifier">&lt;</span><span class="Statement">div</span><span class="Identifier"> onclick=</span><span class="Constant">[=js]</span><span class="Identifier">&gt;</span>unquoted<span class="Identifier">&lt;/</span><span class="Statement">div</span><span class="Identifier">&gt;</span>
    <span class="Identifier">&lt;</span><span class="Statement">div</span><span class="Identifier"> </span><span class="Special">onclick=&quot;</span><span class="Identifier">[</span><span class="Special">=js</span><span class="Identifier">]</span><span class="Special">&quot;</span><span class="Identifier">&gt;</span>quoted<span class="Identifier">&lt;/</span><span class="Statement">div</span><span class="Identifier">&gt;</span>
  <span class="Statement">}</span>
</pre>

<h4>string</h4>

<p>First applies the
<a href="#Escaping%32and%32filtering%32rules_Javascript%45escape">Javascript-escape</a> rule.
and then on top of that the
<a href="#Escaping%32and%32filtering%32rules_HTML%45attr%45nospace%45escape">HTML-attr-nospace-escape</a> rule for an unquoted attribute or the 
<a href="#Escaping%32and%32filtering%32rules_HTML%45attributes%45escape">HTML-attributes-escape</a> rule for a quoted attribute.
</p>

<a name="Escaping%32and%32filtering%32contexts_ZUT%46Javascript"></a><h3>ZUT.Javascript</h3>

<p>Uses the properly formed Javascript as-is, and applies the
<a href="#Escaping%32and%32filtering%32rules_HTML%45attr%45nospace%45escape">HTML-attr-nospace-escape</a> rule for an unquoted attribute or the 
<a href="#Escaping%32and%32filtering%32rules_HTML%45attributes%45escape">HTML-attributes-escape</a> rule for a quoted attribute.
</p>

<h4>other types</h4>

<p>No other type makes sense here and results in a compilation error.
</p>



<a name="Escaping%32and%32filtering%32contexts_HTML%32unquoted%32attribute%32value"></a><h3>HTML unquoted attribute value</h3>

<p>This is inside a tag, in the argument of a parameter that is not quoted:
</p>

<pre class='vimCodeElement'>
  <span class="Statement">TEMPLATE</span> something(<span class="Type">string</span> name) <span class="PreProc">ZUT</span>.Html <span class="PreProc">@public</span>
    <span class="Identifier">&lt;</span><span class="Statement">div</span><span class="Identifier"> </span><span class="Type">id</span><span class="Identifier">=</span><span class="Constant">[=name]</span><span class="Identifier">&gt;</span>some text<span class="Identifier">&lt;/</span><span class="Statement">div</span><span class="Identifier">&gt;</span>
  <span class="Statement">}</span>
</pre>


<h4>string</h4>

<p>Encodes all special characters and spaces with the
Strings undergo the
<a href="#Escaping%32and%32filtering%32rules_HTML%45attr%45nospace%45escape">HTML-attr-nospace-escape</a> rule,
to make sure only one valid attributes value results.
</p>


<h4>ZUT.Url</h4>

<p>The Url is used as a string and the escaped like a string.  This prevents the special meaning of &amp;, among others.
</p>


<h4>other types</h4>

<p>No other types make sense here and result in a compilation error.
</p>


<a name="Escaping%32and%32filtering%32contexts_URL"></a><h3>URL</h3>

<p>The most common use is to insert a URL from a string.  The whole URL will then
be escaped in a way it won't be misinterpreted.  It is also possible to build a
URL from pieces.
</p>

<p>The URL context is used for URL attribute in a HTML tag, such as "href", as
well as for ZUT.Url templates.
</p>

<pre class='vimCodeElement'>
  <span class="Statement">TEMPLATE</span> simpleLink(<span class="Type">string</span> url, <span class="Type">string</span> text) <span class="PreProc">ZUT</span>.Html <span class="PreProc">@public</span>
    <span class="Identifier">&lt;</span><span class="Statement">a</span><span class="Identifier"> </span><span class="Type">href</span><span class="Identifier">=</span><span class="Constant">&quot;[=url]&quot;</span><span class="Identifier">&gt;</span><span class="Underlined">[=text]</span><span class="Identifier">&lt;/</span><span class="Statement">a</span><span class="Identifier">&gt;</span>
  <span class="Statement">}</span>
  <span class="Statement">TEMPLATE</span> flexiLink(<span class="Type">string</span> scheme, <span class="Type">string</span> domain, <span class="Type">string</span> path, <span class="Type">string</span> parameters, <span class="Type">string</span> fragment, <span class="Type">string</span> text) <span class="PreProc">ZUT</span>.Url <span class="PreProc">@public</span>
    <span class="PreProc">[=</span>scheme<span class="PreProc">]</span>//<span class="PreProc">[=</span>domain<span class="PreProc">]</span>/<span class="PreProc">[=</span>path<span class="PreProc">]</span>?<span class="PreProc">[=</span>parameters<span class="PreProc">]</span>#<span class="PreProc">[=</span>fragment<span class="PreProc">]</span>
  <span class="Statement">}</span>
  <span class="Statement">TEMPLATE</span> google(<span class="Type">string</span> query) <span class="PreProc">ZUT</span>.Html <span class="PreProc">@public</span>
    <span class="Identifier">&lt;</span><span class="Statement">a</span><span class="Identifier"> </span><span class="Type">href</span><span class="Identifier">=</span><span class="Constant">&quot;<a href="https://www.google.com/search?q=[=query]">https://www.google.com/search?q=[=query]</a>&quot;</span><span class="Identifier">&gt;</span><span class="Underlined">[=query]</span><span class="Identifier">&lt;/</span><span class="Statement">a</span><span class="Identifier">&gt;</span>
  <span class="Statement">}</span>
</pre>

<h4>string</h4>

<p>At the start, scheme names that are likely to cause problems, such
as javascript:, cause a ZUT.E_BadValue exception to be thrown.
</p>

<p>In most places the
<a href="#Escaping%32and%32filtering%32rules_URL%45escape">URL-escape</a> rule is used.
</p>

<p>For the parameter value, such as "query" in the third example, the
<a href="#Escaping%32and%32filtering%32rules_URL%45escape">URL-param-escape</a> rule is used.
All characters that are special in the value, such as "&"
and "=" are also escaped.
</p>

<p>The detection of using a Zimbu expression that contains a parameter value
happens at runtime: If the generated URL is ending in "?name=", or "&name="
after finding a ?, and an expression follows.
This allows for an expression at any point to start the parameters.
For example:
</p>

<pre class='vimCodeElement'>
  <span class="Statement">TEMPLATE</span> paramLink(<span class="Type">string</span> paramName, <span class="Type">string</span> paramValue) <span class="PreProc">ZUT</span>.Html <span class="PreProc">@public</span>
    <span class="Identifier">&lt;</span><span class="Statement">a</span><span class="Identifier"> </span><span class="Type">href</span><span class="Identifier">=</span><span class="Constant">&quot;localhost/path?[=paramName][=paramValue]&quot;</span><span class="Identifier">&gt;</span><span class="Underlined">here</span><span class="Identifier">&lt;/</span><span class="Statement">a</span><span class="Identifier">&gt;</span>
  <span class="Statement">}</span>
</pre>

<p>When this is invoked with:
</p>

<pre class='vimCodeElement'>
    MyTemplates.paramLink(<span class="Constant">&quot;q=&quot;</span>, <span class="Constant">&quot;it is true&quot;</span>)
</pre>

<p>The result will be "&lt;a href="localhost/path?q=it%20is%20true">here&lt;/a>".
</p>


<h4>ZUT.Url</h4>

<p>Since ZUT.Url is already a well-formed URL, this is passed on as-is, except
when used as a parameter value, then the 
<a href="#Escaping%32and%32filtering%32rules_URL%45escape">URL-param-escape</a> rule is used.
</p>


<h4>other types</h4>

<p>No other type makes sense here and results in a compilation error.
</p>


<a name="Escaping%32and%32filtering%32contexts_CSS"></a><h3>CSS</h3>

<p>CSS is used inside a style element and a ZUT template returning ZUT.Css.
It can also be used inside a style parameter of an HTML tag, with some
restrictions.
</p>

<pre class='vimCodeElement'>
<span class="Statement">TEMPLATE</span> header(<span class="PreProc">ZUT</span>.Css css) <span class="PreProc">ZUT</span>.Html
  <span class="Identifier">&lt;</span><span class="Statement">style</span><span class="Identifier">&gt;</span>
    <span class="Special">[</span><span class="Special">=</span><span class="Constant">css</span><span class="Special">]</span>
  <span class="Identifier">&lt;/</span><span class="Statement">style</span><span class="Identifier">&gt;</span>
<span class="Statement">}</span>

<span class="Statement">TEMPLATE</span> top(<span class="Type">string</span> color) <span class="PreProc">ZUT</span>.Css
  <span class="Statement">p</span> <span class="Identifier">{</span>
    <span class="Type">text</span>-<span class="Type">color</span>: <span class="PreProc">[=</span>color<span class="PreProc">]</span>;
  <span class="Identifier">}</span>
<span class="Statement">}</span>

<span class="Statement">TEMPLATE</span> section(<span class="Type">string</span> style, <span class="Type">string</span> text) <span class="PreProc">ZUT</span>.Html
  <span class="Identifier">&lt;</span><span class="Statement">div</span><span class="Identifier"> </span><span class="Type">style</span><span class="Identifier">=</span><span class="Constant">&quot;[=style]&quot;</span><span class="Identifier">&gt;</span><span class="PreProc">[=</span>text<span class="PreProc">]</span><span class="Identifier">&lt;/</span><span class="Statement">div</span><span class="Identifier">&gt;</span>
<span class="Statement">}</span>
</pre>


<h4>string</h4>

<p>A string is escaped with the
<a href="#Escaping%32and%32filtering%32rules_CSS%45escape">CSS-escape</a> rule.
to make sure it does not terminate the style element prematurely.
</p>

<h4>ZUT.Css</h4>

<p>A ZUT.Css object is properly formed and is passed on as-is.
</p>

<h4>other types</h4>

<p>No other type makes sense in CSS and result in a compilation error.
Note that a URL must always be inside url(), See
<a href="#Escaping%32and%32filtering%32contexts_CSS%32URL">CSS URL</a>
</p>


<a name="Escaping%32and%32filtering%32contexts_CSS%32string"></a><h3>CSS string</h3>

<p>A CSS string can be single or double quoted.
</p>

<pre class='vimCodeElement'>
<span class="Statement">TEMPLATE</span> strings(<span class="Type">string</span> text) <span class="PreProc">ZUT</span>.Css
  single: <span class="Constant">'[=text]'</span>;
  double: <span class="Constant">&quot;[=text]&quot;</span>;
<span class="Statement">}</span>
</pre>

<h4>string</h4>

<p>Strings are escaped with the
<a href="#Escaping%32and%32filtering%32rules_CSS%45string%45escape">CSS-string-escape</a> rule
so that they are used literally.
</p>


<h4>other types</h4>

<p>No other type makes sense in a CSS string and results in a compilation error.
Note that a URL must always be inside url(), See
<a href="#Escaping%32and%32filtering%32contexts_CSS%32URL">CSS URL</a>
</p>


<a name="Escaping%32and%32filtering%32contexts_CSS%32URL"></a><h3>CSS URL</h3>

<p>A CSS accepts a URL inside url(), with or without quotes:
</p>

<pre class='vimCodeElement'>
<span class="Statement">TEMPLATE</span> strings(<span class="Type">string</span> url) <span class="PreProc">ZUT</span>.Css
  <span class="Statement">h1</span> <span class="Identifier">{</span> <span class="Type">background</span>: <span class="Identifier">url(</span><span class="Constant">[=url]</span><span class="Identifier">)</span>; <span class="Identifier">}</span>
  <span class="Statement">h2</span> <span class="Identifier">{</span> <span class="Type">background</span>: <span class="Identifier">url(</span><span class="Constant">'[=url]'</span><span class="Identifier">)</span>; <span class="Identifier">}</span>
  <span class="Statement">h3</span> <span class="Identifier">{</span> <span class="Type">background</span>: <span class="Identifier">url(</span><span class="Constant">&quot;[=url]&quot;</span><span class="Identifier">)</span>; <span class="Identifier">}</span>
<span class="Statement">}</span>
</pre>

<h4>string</h4>

<p>Strings are escaped with the
<a href="#Escaping%32and%32filtering%32rules_URL%45escape">URL-escape</a> rule
to ensure the result is a valid URL.
</p>


<h4>ZUT.Url</h4>

<p>A ZUT.Url is already well-formed and will be inserted as-is when used without
any prefix.  It will be escaped when there is a prefix.
</p>


<h4>other types</h4>

<p>No other type makes sense in a CSS string and results in a compilation error.
</p>


<a name="Escaping%32and%32filtering%32contexts_CSS%32comment"></a><h3>CSS comment</h3>

<p>A CSS comment must be a block comment.
</p>

<pre class='vimCodeElement'>
<span class="Statement">TEMPLATE</span> comments(<span class="Type">string</span> text) <span class="PreProc">ZUT</span>.Css
  <span class="Comment">/* [=text]</span>
<span class="Comment">   */</span>
<span class="Statement">}</span>
</pre>

<p>Any type can be passed here, the
<a href="#Escaping%32and%32filtering%32rules_CSS%45comment%45escape">CSS-comment-escape</a>
rule will be used.
</p>



<a name="Escaping%32and%32filtering%32contexts_Javascript"></a><h3>Javascript</h3>

<p>Javascript code is used inside a script element and in handler attributes of
elements, such as "onclick".
</p>

<pre class='vimCodeElement'>
<span class="Statement">TEMPLATE</span> error(<span class="Type">int</span> error, <span class="Type">string</span> varName) <span class="PreProc">ZUT</span>.Javascript
  alert('error ' + <span class="PreProc">[=</span>error<span class="PreProc">]</span>);
  <span class="PreProc">[=</span>varName<span class="PreProc">]</span> = false;
<span class="Statement">}</span>
</pre>

<h4>string</h4>

<p>A string is escaped with the
<a href="#Escaping%32and%32filtering%32rules_Javascript%45escape">Javascript-escape</a> rule.
This does not do much escaping, it does check for valid Javascript.
Inside a script element it makes sure it does not terminate the script element.
</p>

<p>Note that it is still very well possible to mess up the resulting Javascript,
be careful!
</p>


<h4>ZUT.Javascript</h4>

<p>A ZUT.Javascript object is properly formed and is passed on as-is.
</p>


<h4>other types</h4>

<p>No other type makes sense in Javascript and results in a compilation error.
</p>


<a name="Escaping%32and%32filtering%32contexts_Javascript%32string"></a><h3>Javascript string</h3>

<p>A Javascript string can be single or double quoted.  We also handle a regular
expression like a string.
</p>

<pre class='vimCodeElement'>
<span class="Statement">TEMPLATE</span> strings(<span class="Type">string</span> text) <span class="PreProc">ZUT</span>.Javascript
  var single = '<span class="PreProc">[=</span>text<span class="PreProc">]</span>';
  var double = &quot;<span class="PreProc">[=</span>text<span class="PreProc">]</span>&quot;;
  var regexp = /<span class="PreProc">[=</span>text<span class="PreProc">]</span>/;
<span class="Statement">}</span>
</pre>

<h4>string</h4>

<p>Strings are escaped with the
<a href="#Escaping%32and%32filtering%32rules_Javascript%45string%45escape">Javascript-string-escape</a> rule
so that they are used literally.
</p>


<h4>ZUT.Url</h4>

<p>A Url is converted to a string and escaped like a string.  Specifically, when
used in a regular expression slashes are escaped with a backslash.
</p>


<h4>other types</h4>

<p>No other type makes sense in a Javascript string and results in a compilation
error.
</p>


<a name="Escaping%32and%32filtering%32contexts_Javascript%32comment"></a><h3>Javascript comment</h3>

<p>A Javascript comment can be a line comment or a block comment.
</p>

<pre class='vimCodeElement'>
<span class="Statement">TEMPLATE</span> comments(<span class="Type">string</span> text) <span class="PreProc">ZUT</span>.Javascript
  // <span class="PreProc">[=</span>text<span class="PreProc">]</span>
  /* <span class="PreProc">[=</span>text<span class="PreProc">]</span>
   */
<span class="Statement">}</span>
</pre>

<p>Any type can be passed here, the
<a href="#Escaping%32and%32filtering%32rules_Javascript%45comment%45escape">Javascript-comment-escape</a>
rule will be used.
</p>


<div class="sep2"></div>
<a name="Escaping%32and%32filtering%32rules"></a><h2>Escaping and filtering rules</h2>

<a name="Escaping%32and%32filtering%32rules_HTML%45escape"></a><h3>HTML-escape</h3>

<p>This makes sure that any text is displayed as-is.
</p>

<table cellpadding=0 cellspacing=0 border=0>
<tr class="firstrow" valign="top"><td class="firstcol">character  </td><td class="col">replacement</td></tr>
<tr valign="top"><td class="firstcol">NUL         </td><td class="col">&amp;#0;   </td><td class="col">0x00</td></tr>
<tr valign="top"><td class="firstcol">&amp;       </td><td class="col">&amp;amp;  </td></tr>
<tr valign="top"><td class="firstcol">"           </td><td class="col">&amp;quot; </td><td class="col">double quote</td></tr>
<tr valign="top"><td class="firstcol">'           </td><td class="col">&amp;#39;  </td><td class="col">single quote</td></tr>
<tr valign="top"><td class="firstcol">&lt;        </td><td class="col">&amp;lt;   </td></tr>
<tr valign="top"><td class="firstcol">&gt;        </td><td class="col">&amp;gt;   </td></tr>
<tr valign="top"><td class="firstcol">\n          </td><td class="col">&lt;br&gt; </td><td class="col">a line break</td></tr>
</td></tr></table>


<a name="Escaping%32and%32filtering%32rules_HTML%45data%45escape"></a><h3>HTML-data-escape</h3>

<p>This makes sure that any text is displayed as-is, but keeps &amp; characters
and does not replace line breaks.
</p>

<table cellpadding=0 cellspacing=0 border=0>
<tr class="firstrow" valign="top"><td class="firstcol">character  </td><td class="col">replacement</td></tr>
<tr valign="top"><td class="firstcol">NUL         </td><td class="col">&amp;#0;   </td><td class="col">0x00</td></tr>
<tr valign="top"><td class="firstcol">"           </td><td class="col">&amp;quot; </td><td class="col">double quote</td></tr>
<tr valign="top"><td class="firstcol">'           </td><td class="col">&amp;#39;  </td><td class="col">single quote</td></tr>
<tr valign="top"><td class="firstcol">&lt;        </td><td class="col">&amp;lt;   </td></tr>
<tr valign="top"><td class="firstcol">&gt;        </td><td class="col">&amp;gt;   </td></tr>
</td></tr></table>

<p>This is used for title elements and HTML comments, when the contents
comes from a ZUT.Html object.
</p>


<a name="Escaping%32and%32filtering%32rules_HTML%45tagname%45escape"></a><h3>HTML-tagname-escape</h3>

<p>This does not actually do escaping, but only lets through a valid tag name.
Leading and trailing white space is removed.
</p>

<p>Valid characters are ASCII letters, numbers, dashes, and underscores.
</p>

<p>An invalid tag name causes a ZUT.E_BadValue exception to be thrown.
</p>

<p>The names "script", "style" and "title" are rejected, because these
require different escaping, which could not be setup at compile time.
</p>


<a name="Escaping%32and%32filtering%32rules_HTML%45attributes%45escape"></a><h3>HTML-attributes-escape</h3>

<p>Changes &amp; and control characters into the &amp;amp; form.
</p>


<a name="Escaping%32and%32filtering%32rules_HTML%45attr%45value%45escape"></a><h3>HTML-attr-value-escape</h3>

<p>This escapes &amp;, quotes an control characters into the &amp;amp form.
For CSS values this is on top of the CSS-escape rule.
For Javascript values this is on top of the Javascript-escape rule.
</p>


<a name="Escaping%32and%32filtering%32rules_HTML%45attr%45nospace%45escape"></a><h3>HTML-attr-nospace-escape</h3>

<p>Like HTML-attr-value-escape plus escaping spaces.
</p>


<a name="Escaping%32and%32filtering%32rules_URL%45escape"></a><h3>URL-escape</h3>

<p>In a URL escaping happens by replacing a byte with its hexadecimal value,
preceded by %. Thus = is replaced with %3D and  % itself is replaced with %25.
</p>

<p>All characters are escaped, except: "-_.!~*", all
ASCII letters and digits, and the characters that are listed under
URL-param-escape.
</p>


<a name="Escaping%32and%32filtering%32rules_URL%45param%45escape"></a><h3>URL-param-escape</h3>

<p>This is like URL-escape, but additionally these characters are escaped:
";,/?:@&=+$#".
</p>


<a name="Escaping%32and%32filtering%32rules_CSS%45escape"></a><h3>CSS-escape</h3>

<p>This does not actually escape, but throws an ZUT.E_BadValue exception in the
following cases:
</p>
<ul>
<li>an unterminated string
</li>
<li>an unterminated /* comment
</li>
<li>a trailing backslash
</li>
<li>a NUL character
</li>
<li>&lt;/ found (could be &lt;/style&gt;)
</li>
</ul>


<a name="Escaping%32and%32filtering%32rules_CSS%45string%45escape"></a><h3>CSS-string-escape</h3>

<p>This inserts a backslash before a backslash.
</p>

<p>For a single quoted string single quotes are escaped with a backslash.
</p>

<p>For a double quoted string double quotes are escaped with a backslash.
</p>

<p>A line break is changed to "\a".
</p>

<p>NUL characters are dropped.
</p>


<a name="Escaping%32and%32filtering%32rules_CSS%45comment%45escape"></a><h3>CSS-comment-escape</h3>

<p>This works the same as the 
<a href="#Escaping%32and%32filtering%32rules_Javascript%45comment%45escape">Javascript-comment-escape</a>
rule
</p>


<a name="Escaping%32and%32filtering%32rules_Javascript%45escape"></a><h3>Javascript-escape</h3>

<p>This does not actually escape, but throws an ZUT.E_BadValue exception in the
following cases:
</p>
<ul>
<li>an unterminated string or regexp
</li>
<li>an unterminated // comment
</li>
<li>an unterminated /* comment
</li>
<li>a trailing backslash
</li>
<li>a NUL character
</li>
<li>&lt;/ found (could be &lt;/script&gt;)
</li>
</ul>


<a name="Escaping%32and%32filtering%32rules_Javascript%45string%45escape"></a><h3>Javascript-string-escape</h3>

<p>This inserts a backslash before a backslash.
</p>

<p>For a single quoted string single quotes are escaped with a backslash.
</p>

<p>For a double quoted string double quotes are escaped with a backslash.
</p>

<p>For a regular expression slashes are escaped with a backslash.
</p>

<p>A line break is changed to "\n".
</p>

<p>NUL characters are dropped.
</p>


<a name="Escaping%32and%32filtering%32rules_Javascript%45comment%45escape"></a><h3>Javascript-comment-escape</h3>

<p>For a "//" comment after every line break "//" is inserted.
</p>

<p>For a "/*" comment every "*/" is changed to "* /" (inserting a space).
</p>

<p>NUL characters are dropped.
</p>



<div class="sep1"></div>
<a name="Controllers"></a><h1>Controllers</h1>

<p>To make it easier to write HTML that interacts with the user a controller can
be used.  The name of the controller is put into the HTML with a "zcontroller"
attribute.  The element it is in and all its children are then considered to be
under control of this controller.
</p>

<p>Example:
<pre class='vimCodeElement'>
<span class="Statement">TEMPLATE</span> okButton() <span class="PreProc">ZUT</span>.Html
  <span class="Identifier">&lt;</span><span class="Statement">div</span><span class="Identifier"> zcontroller=</span><span class="Constant">&quot;OkController&quot;</span><span class="Identifier">&gt;</span>
    <span class="Identifier">&lt;</span><span class="Statement">button</span><span class="Identifier"> zaction=</span><span class="Constant">&quot;click: okClicked&quot;</span><span class="Identifier">&gt;</span>OK<span class="Identifier">&lt;/</span><span class="Statement">button</span><span class="Identifier">&gt;</span>
  <span class="Identifier">&lt;/</span><span class="Statement">div</span><span class="Identifier">&gt;</span>
<span class="Statement">}</span>
</pre>
</p>

<p>Actions on elements are assigned to a controller with a "zaction" attribute.
The ZUT system will intercept events, such as a mouse click, and find the
matching "zaction".  The specified method will then be invoked on the nearest
controller, found upwards in the element tree.
</p>

<p>When an action is recognized and the controller is indentified, the ZUT runtime
code will instantiate a controller and invoke the specified action method.
When a controller was previously created it will be re-used,
</p>

<p>The controller code is compiled into Javascript.  It is either included in the
page, or loaded at a later time, latest when the controller is actually used.
</p>

<p>The compiler will verify the action handler actually exists.  Thus a missing
action handler results in a compilation error.
</p>


<div class="sep2"></div>
<a name="zcontroller%32attribute"></a><h2>zcontroller attribute</h2>

<p>The zcontroller attribute specifies the name of a class.  That class must have
been imported in the template.  E.g., when using 'zcontroller="MyController"'
there should be an 'IMPORT "MyController.zu"' statement (possibly with a path).
</p>


<div class="sep2"></div>
<a name="zaction%32attribute"></a><h2>zaction attribute</h2>

<p>The zaction attribute is a comma separated list of items.  Each item specifies
an action type and the method to call. They are separted by a colon.  For
example, "mouseDown: down, mouseUp: up".
</p>

<p>The list of action types:
</p>
<table cellpadding=0 cellspacing=0 border=0>
<tr valign="top"><td class="firstcol">click</td><td class="col"> a mouse click (triggers when the mouse button is released)</td></tr>
<tr valign="top"><td class="firstcol">doubleClick</td><td class="col">two mouse clicks within a short time</td></tr>
<tr valign="top"><td class="firstcol">longClick</td><td class="col">mouse click that takes long (about 2 seconds)</td></tr>
<tr valign="top"><td class="firstcol">mouseDown</td><td class="col">pressing the mouse button</td></tr>
<tr valign="top"><td class="firstcol">mouseUp</td><td class="col">releasing the mouse button</td></tr>
<tr valign="top"><td class="firstcol">mouseOver</td><td class="col">when the mouse enters an element</td></tr>
<tr valign="top"><td class="firstcol">mouseOut</td><td class="col">when the mouse leaves an element</td></tr>
<tr valign="top"><td class="firstcol">mouseMove</td><td class="col">when the mouse moves inside an element</td></tr>
<tr valign="top"><td class="firstcol">key</td><td class="col">key press and release (not for modifier keys)</td></tr>
<tr valign="top"><td class="firstcol">keyDown</td><td class="col">a keyboard key press (also for modifier keys)</td></tr>
<tr valign="top"><td class="firstcol">keyUp</td><td class="col">a keyboard key release (also for modifier keys)</td></tr>
<tr valign="top"><td class="firstcol">valueChange</td><td class="col">the value of the element changed</td></tr>
</td></tr></table>

<p>Note: Most actions will work on most browsers, but there can be slight
differences, especially with older browsers.
</p>


<div class="sep2"></div>
<a name="action%32method"></a><h2>action method</h2>

<p>The controller class must define the methods for the actions used.
The method signature must be like this:
<pre class='vimCodeElement'>
  <span class="Statement">FUNC</span> $clicked(<span class="PreProc">ZUT</span>.Event event) <span class="Type">bool</span>
</pre>
</p>

<p>The ZUT.Event contains all the relevant information about the event.
For example, event.element is the HTML element where the event was detected.
</p>

<p>The function must return TRUE if the event bubbles up.  That means it is passed
on to action handlers up in the DOM tree.  If the function returns FALSE no
other action handler will be invoked.
</p>

<p>Keep in mind that the action methods are always executed in the browser, they
are produced as Javascript.
</p>

<p>The action method may in turn use a template to generate HTML and update the
page to show it.  See the zutdemo program for examples.
</p>


<div class="sep2"></div>
<a name="Passing%32data"></a><h2>Passing data</h2>

<p>A controller can be instantiated many times, e.g. one for every button.  It
must then be able to know what button in the page it's controlling.  A good
practice is to use data attributes.  These have the form "data-name", where
"name" can be freely chosen.
</p>

<p>Example ZUT template:
<pre class='vimCodeElement'>
  <span class="Statement">TEMPLATE</span> demo(<span class="Type">string</span> text) <span class="PreProc">ZUT</span>.Html <span class="PreProc">@public</span>
    <span class="PreProc">[</span><span class="Type">string</span> helloId = <span class="PreProc">ZUT</span>.uid()<span class="PreProc">]</span>
    <span class="Identifier">&lt;</span><span class="Statement">div</span><span class="Identifier"> zcontroller=</span><span class="Constant">&quot;MyController&quot;</span>
<span class="Identifier">         zaction=</span><span class="Constant">&quot;click: clicked&quot;</span>
<span class="Identifier">         </span><span class="Type">data</span><span class="Identifier">-</span><span class="Type">id</span><span class="Identifier">=</span><span class="Constant">&quot;[=helloId]&quot;</span><span class="Identifier">&gt;</span>
      <span class="PreProc">[=</span>text<span class="PreProc">]</span>
    <span class="Identifier">&lt;/</span><span class="Statement">div</span><span class="Identifier">&gt;</span>
    <span class="Identifier">&lt;</span><span class="Statement">div</span><span class="Identifier"> </span><span class="Type">id</span><span class="Identifier">=</span><span class="Constant">&quot;[=helloId]&quot;</span><span class="Identifier">&gt;</span><span class="Identifier">&lt;/</span><span class="Statement">div</span><span class="Identifier">&gt;</span>
  <span class="Statement">}</span>
</pre>
</p>

<p>With this code in the action handler:
<pre class='vimCodeElement'>
    <span class="Type">string</span> id = <span class="PreProc">ZUT</span>.getAttribute(event.element, <span class="Constant">&quot;data-id&quot;</span>)
    <span class="Type">callback</span>&lt;<span class="PreProc">ZUT</span>.HtmlFunc, <span class="Type">string</span>&gt; cb = <span class="PreProc">NEW</span>(MyTemplate.message, <span class="Constant">&quot;Hello World!&quot;</span>)
    <span class="PreProc">ZUT</span>.fillElement(id, cb)
</pre>
</p>

<p>In this example, a unique ID is created with ZUT.uid().  It is used as the id
in the element that needs to be changed.  It is passed to the action handler
with the "data-id" attribute on the element that is clicked on.
</p>


<div class="sep1"></div>
<a name="Copyright"></a><h1>Copyright</h1>

<p>Copyright 2014 Bram Moolenaar  All Rights Reserved.
</p>

<p>Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
The License can be found it in the LICENSE file, or you may obtain a copy of
the License at http://www.apache.org/licenses/LICENSE-2.0
</p>

<p>Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.  See the
License for the specific language governing permissions and limitations
under the License.
</p>

</body>
</html>
