#
# The Zimbu compiler written in Zimbu
#
# Tests for the builtin module IO.
#
#*license
#* Copyright 2015 Bram Moolenaar  All Rights Reserved.
#*
#* Licensed under the Apache License, Version 2.0.  See the LICENSE file or
#* obtain a copy at: http://www.apache.org/licenses/LICENSE-2.0
#

FUNC test_Url() status
  IO.Url url = NEW("proto://domain.com:123/path?p1=v1&p2#frag")

  TEST.equal("proto://domain.com:123/path?p1=v1&p2#frag", url.ToString(), "URL")
  TEST.equal("proto:", url.getProtocol(), "protocol")
  TEST.equal("domain.com", url.getDomain(), "domain")
  TEST.equal(123, url.getPort(), "port")
  TEST.equal("path", url.getPath(), "path")
  TEST.true(url.hasParameter("p1"), "hasParameter(p1)")
  TEST.equal("v1", url.getParameter("p1"), "parameter(p1)")
  TEST.true(url.hasParameter("p2"), "hasParameter(p2)")
  TEST.equal(NIL, url.getParameter("p2"), "parameter(p2)")
  TEST.false(url.hasParameter("none"), "hasParameter(none)")
  TEST.equal(NIL, url.getParameter("none"), "parameter(none)")
  TEST.equal("frag", url.getFragment(), "fragment")

  url.setProtocol("getit:")
  url.setDomain("there.org")
  url.setPort(777)
  url.setPath("base/dir")
  url.setParameter("lang", "fil")
  url.removeParameter("p2")
  url.removeParameter("dummy")
  url.setFragment("theEnd")
  TEST.equal("getit://there.org:777/base/dir?p1=v1&lang=fil#theEnd",
             url.ToString(),
             "modified URL")
  RETURN OK
}
